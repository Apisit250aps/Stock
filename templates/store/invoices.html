{% extends 'store/base.html' %}
<!--  -->
{% block content %}
<!--  -->
<!-- Button trigger modal -->


<!-- Modal -->
<div class="modal fade" id="filter" tabindex="-1" aria-labelledby="filterLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered">
        <form class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterLabel">Filter</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="from-date">From</label>
                    <div class="input-group input-group-merge">
                        <span id="from-date2" class="input-group-text"><i
                                class="bx bx-calendar"></i></span>
                        <input type="date" class="form-control" id="from-date" placeholder="John Doe"
                            aria-label="John Doe" aria-describedby="from-date2" v-model="filter.from_date"/>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label" for="to-date">To</label>
                    <div class="input-group input-group-merge">
                        <span id="to-date2" class="input-group-text"><i
                                class="bx bx-calendar"></i></span>
                        <input type="date" class="form-control" id="to-date" placeholder="John Doe"
                            aria-label="John Doe" aria-describedby="to-date2"  v-model="filter.to_date"/>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" @click="onFilter($event)" class="btn btn-primary">Search</button>
            </div>
        </form>
    </div>
</div>


<div class="card h-100">
    <div class="d-flex align-items-center justify-content-between card-header">
        <h1 class="">
            Invoices
        </h1>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#filter">
            <i class="bx bx-filter-alt"></i>
        </button>
    </div>

    <div class="table-responsive text-nowrap overflow-y-scroll">
        <table class="table table-borderless table-hover">
            <thead>
                <tr>
                    <th>invoice no</th>
                    <th>total price</th>
                    <th>discount</th>
                    <th>type</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(item, index) in invoices" :key="index">
                    <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <strong>INV-[{item.invoice_no}]</strong>
                    </td>
                    <td>[{item.total_price}] ฿</td>
                    <td>
                        [{item.discount}] ฿
                    </td>
                    <td>
                        <span v-if="item.type == 1" class="badge bg-label-success me-1">new</span>
                        <span v-if="item.type == 2" class="badge bg-label-warning me-1">add</span>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="javascript:void(0);"><i class="bx bx-edit-alt me-1"></i>
                                    Edit</a>
                                <a class="dropdown-item" href="javascript:void(0);"><i class="bx bx-trash me-1"></i>
                                    Delete</a>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}
<!--  -->
{% block script %}
<script>
    const { createApp } = Vue;
    const app = createApp(
        {
            delimiters: ["[{", "}]"],
            data() {
                return {
                    layout: "store",
                    page: "invoices",
                    invoices: null,
                    filter:{
                        from_date:"",
                        to_date:"",
                    }
                };
            },
            async mounted() {
                axios(
                    {
                        method: "get",
                        url: "{% url 'get-shop-invoice-api' %}"
                    }
                ).then((response) => {
                    this.invoices = response.data;
                });
            },
            methods:{
                onFilter(e){
                    e.preventDefault()
                    let isValid = true
                    if(this.filter.from_date != ""){
                        
                        if (this.filter.to_date != ""){
                            
                            if (this.filter.to_date < this.filter.from_date){
                                isValid = false
                                console.log(isValid)
                            }
                            
                        }
                    }
                    if (isValid){
                        const form_data = new FormData;
                        form_data.append("csrfmiddlewaretoken", "{{csrf_token}}")
                        form_data.append("from", this.filter.from_date)
                        form_data.append("to", this.filter.to_date)

                        axios(
                            {
                                method:"post",
                                url:"{% url 'filter-shop-invoice-api' %}",
                                data:form_data
                            }
                        ).then((response)=>{
                            console.log(response.status)
                            this.invoices = response.data;
                        })
                    }

                }
            }
        }
    );
    app.mount("#app")
</script>
{% endblock script %}